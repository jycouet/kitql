name: Tests

on:
 pull_request:
  paths:
   - '**'

jobs:
 build:
  name: Builds & Tests
  runs-on: ubuntu-latest
  timeout-minutes: 10
  strategy:
   matrix:
    prj:
     [
      docs,
      helpers,
      internals,
      sveltekit,
      handles,
      vite-plugin-kit-routes,
      vite-plugin-watch-and-run,
      vite-plugin-stripper,
      eslint-config,
     ]
  steps:
   - name: ğŸ‰ Checkout Repository
     uses: actions/checkout@v4
     with:
      # This makes Actions fetch all Git history so that Changesets can generate changelogs with the correct commits
      fetch-depth: 0
      submodules: recursive

   - name: ğŸª› pnpm setup
     uses: pnpm/action-setup@v4
     with:
      version: 10.5.2
      run_install: false

   - name: ğŸ› ï¸ node setup
     uses: actions/setup-node@v4
     with:
      node-version: 22.14.0
      cache: pnpm

   - name: ğŸ§‘â€ğŸ’» install
     run: pnpm i

   - name: ğŸš§ Build all Packages
     run: pnpm -r build

   - name: ğŸ§¹ Lint
     run: pnpm -F ${{ matrix.prj }} lint

   - name: ğŸ’ª Check
     run: pnpm -F ${{ matrix.prj }} check

   - name: ğŸ‘Œ Run Tests
     run: pnpm -F ${{ matrix.prj }} test:ci
