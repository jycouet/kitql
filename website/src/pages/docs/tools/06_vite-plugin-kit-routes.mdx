import { Callout } from '@theguild/components'

# ‚ö° How to - `vite-plugin-kit-routes`

`vite-plugin-kit-routes` automatically updates route references in SvelteKit projects, crucial for
large applications where manual tracking of route changes is error-prone. It simplifies development
by ensuring all route links are consistent and up-to-date, saving time and preventing broken links.

You will essentially have 4 objects at your disposal: `PAGES`, `SERVERS`, `ACTIONS` and `LINKS` and
instead of hardcode strings, you will use these objects that are always up to date with your routes.

No more ü§û, now be **confident** ‚úÖ!

By default, no Configuration is requiered. Just [Install](#installation) the plugin, and use objects
available in your `$lib/ROUTES.ts` generated file _(always in sync)_.

## Examples

```svelte filename="PAGES - First example" {2, 9}
<script lang="ts">
  import { PAGES } from '$lib/ROUTES'
</script>

<!-- ü§û before, hardcoded string, error prone -->
<a href="/terms-and-conditions">Terms</a>

<!-- ‚úÖ after, typechecked route, no more errors -->
<a href={PAGES['/terms-and-conditions']}>Terms</a>
<!-- 
   If you change location of `/terms-and-conditions/+page.svelte`: 
     - the key '/terms-and-conditions' will not exist
     - `PAGES` object will yell! 
-->
```

```svelte filename="PAGES - With 1 route param" {2, 9}
<script lang="ts">
  import { PAGES } from '$lib/ROUTES'
</script>

<!-- ü§û before, hardcoded string, error prone -->
<a href="/site_contract/{siteId}">Go to site</a>

<!-- ‚úÖ after, typechecked route, no more errors -->
<a href={PAGES['/site_contract/{siteId}']({ siteId })}>Go to site</a>
```

```svelte filename="PAGES - With 1 Search Param*" {2, 9}
<script lang="ts">
  import { PAGES } from '$lib/ROUTES'
</script>

<!-- ü§û before, hardcoded string, error prone -->
<a href="/site_contract/{siteId}?limit={3}">Go to site</a>

<!-- ‚úÖ after, typechecked route, no more errors -->
<a href={PAGES['/site_contract/{siteId}']({ siteId, limit: 3 })}>Go to site</a>
```

```svelte filename="ACTIONS - With a named action" {4, 12}
<script lang="ts">
  import { enhance } from '$app/forms'
  import { page } from '$app/stores'
  import { ACTIONS } from '$lib/ROUTES'

  const siteId = $page.params.siteId

  // ü§û before, hardcoded string, error prone
  const action =  `/site_contract/${siteId}?/send`

  // ‚úÖ after, typechecked route, no more errors
  const action = ACTIONS['/site_contract/${siteId}']('send', { siteId })
</script>

<form method="POST" use:enhance {action}>
  <button>Check</button>
</form>
```

```svelte filename="LINKS - 1 reference in config*" {2, 9}
<script lang="ts">
  import { LINKS } from '$lib/ROUTES'
</script>

<!-- ü§û before, hardcoded string, error prone -->
<a href="https://twitter.com/jycouet">Twitter</a>

<!-- ‚úÖ after, typechecked route, no more errors -->
<a href={LINKS.twitter}>Twitter</a>
```

```svelte filename="LINKS - with params & search params*" {2, 9}
<script lang="ts">
  import { LINKS } from '$lib/ROUTES'
</script>

<!-- ü§û before, hardcoded string, error prone -->
<img src="https://www.gravatar.com/avatar/jycouet?s=20&d=identicon" alt="logo" />

<!-- ‚úÖ after, typechecked route, no more errors -->
<img src={LINKS.gravatar({ str: 'jycouet', s: 20 })} alt="logo" />
```

<br />
<em>* You can add a lot of configs to specify search params, types, ...</em>
## Installation

```sh npm2yarn
npm i -D vite-plugin-kit-routes
```

## Demo

### Local

```bash
npm create kitql@latest --template kit-routes
```

### Online

[![](https://img.shields.io/badge/Open_in-SvelteLab-black?logo=svelte&color=%23FF3E00)](https://www.sveltelab.dev/?provider=github&owner=jycouet&repo=kitql&branch=main&path=%2Fpackages%2Fcreate-kitql%2Ftemplates%2Fkit-routes)

[![](https://img.shields.io/badge/Open_in-CodeSandbox-black?logo=codesandbox&color=%23151515)](https://codesandbox.io/p/sandbox/github/jycouet/kitql/tree/main/packages/create-kitql/templates/kit-routes)

[![](https://img.shields.io/badge/Open_in-StackBlitz-black?logo=stackblitz&color=%231269D3)](https://stackblitz.com/github.com/jycouet/kitql/tree/main/packages/create-kitql/templates/kit-routes)

## Configuration

Add the plugin like this:

```js filename="vite.config.js" {2, 9}
import { sveltekit } from '@sveltejs/kit/vite'
import { kitRoutes } from 'vite-plugin-kit-routes'

/** @type {import('vite').UserConfig} */
const config = {
  plugins: [
    sveltekit(),
    // ‚úÖ Add the plugin
    kitRoutes()
  ]
}

export default config
```

It will generate a file `./src/lib/ROUTES.ts` at the start of your dev server & any update of any of
your `+page.svelte` | `+server.ts` | `+page.server.ts`.

## Side Notes

<Callout>You can make use of `ctrl + space` to discover config options. üéâ</Callout>

---

- What kind of person are you: `PAGES['/info/terms']` or `PAGES.info_terms` ?

_You can choose anyway_ üòú

```ts filename="vite.config.ts"
kitRoutes({
  // format: '/' (default)
  format: '_'
})
```

- You like nice and formated files? You can add **any** cmd after the generation

```ts filename="vite.config.ts"
kitRoutes({
  post_update_run: 'npm exec prettier ./src/lib/ROUTES.ts -- -w'
})
```

- You can specify a searchParam for some paths _(you can also do it globally)_

```ts filename="vite.config.ts"
kitRoutes({
  PAGES: {
    site: {
      explicit_search_params: {
        limit: { type: 'number' }
      }
    }
  }
})
```

- You can narrow down the type of params _(You can also change `"string | number"` default
  globally)_

```ts filename="vite.config.ts"
kitRoutes({
  PAGES: {
    site_id: {
      params: {
        id: { type: 'string' }
      }
    }
  }
})
```

- You want better typings? Add the `KIT_ROUTES` type... It will be crazy good! I'm not sure you are
  ready! _Under `PAGES`, `SERVERS` and `ACTIONS`, you will get autocompletion for route config._ ü§Ø

```ts filename="vite.config.ts"
import type { KIT_ROUTES } from '$lib/ROUTES'
import { kitRoutes } from 'vite-plugin-kit-routes'

kitRoutes<KIT_ROUTES>({
  // Conf
})
```

- You are concerned about `code splitting` and/or `privacy` ? Let's generate variables instead of
  objects!

```ts filename="vite.config.ts"
kitRoutes({
  format: 'variables'
})
```

```ts filename="src/lib/ROUTES.ts" {7-9}
// With format: '_', it was like üëá
// export const PAGES: {
//  main: '/main',
//  about '/about'
// }

// With format: 'variables' it's like üëá
export const PAGES_main = '/main'
export const PAGES_about '/about'
```

- You want to use some `LINKS` in different places in your app? Let's show you what we can do:

```ts filename="vite.config.ts"
kitRoutes({
  LINKS: {
    // reference to a hardcoded link
    twitter: 'https://twitter.com/jycouet',
    // ‚úÖ <a href={LINKS.twitter}>Twitter</a>

    // reference to link with params! (Like svelteKit routes add [ ] to specify params)
    twitter_post: 'https://twitter.com/[name]/status/[id]',
    // ‚úÖ <a href={LINKS.twitter_post({ name: 'jycouet', id: '1727089217707159569' })}>Twitter Post</a>

    // reference to link with params & search params!
    gravatar: {
      href: 'https://www.gravatar.com/avatar/[str]',
      explicit_search_params: {
        s: { type: 'number', default: 75 },
        d: { type: '"retro" | "identicon"', default: '"identicon"' }
      }
    }
    // ‚úÖ <img src={LINKS.gravatar({ str: 'jycouet', s: 20 })} alt="logo" />
  }
})
```

---

Let me know what I forgot to add on [TwiX](https://twitter.com/jycouet), or what you would like to
see in the future. üôè
